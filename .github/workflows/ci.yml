name: CI

# This workflow will do a compile, scan, test, and package
# with a variety of languages and environments.
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/about-continuous-integration

permissions:
  contents: read
  pull-requests: read

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [20.x, 22.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # Fetch all history so that --all is available

    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm' # Cache npm dependencies

    - name: Install Dependencies
      run: npm ci

    - name: Setup Biome
      uses: biomejs/setup-biome@v3
      with:
        biome_version: "1.7.3" # Specify the desired Biome version

    - name: Lint with Biome
      run: biome lint --apply --no-warn=false

    - name: Format with Biome
      run: biome format --write --no-warn=false

    - name: Run Vitest (Unit Tests)
      run: npm test

    - name: Build Application (e.g., for Production)
      # This step depends on your project's build command. Assuming 'npm run build'
      # For React Native Expo, this might be different (e.g., eas build)
      # This is a placeholder and may need adjustment based on actual build process.
      run: npm run build --if-present

    # - name: Run Playwright (E2E Tests) - Placeholder
    #   # This would typically run after a build and potentially after deploying to a test environment.
    #   # For cross-platform (mobile/web), E2E testing setup can be complex.
    #   # Ensure Playwright is installed and configured for your target environments (web, Android, iOS).
    #   # Example (Web): npx playwright install --with-deps
    #   # Example (Run): npx playwright test
    #   run: echo "Playwright E2E tests would run here."

    # - name: Upload Artifacts (e.g., build outputs, test reports)
    #   # Customize artifact names and paths as needed
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: app-build-output
    #     path: ./dist # Example path, adjust to your build output directory

    # - name: Codecov Upload - Placeholder
    #   # Requires Codecov token and setup. Ensure coverage is generated by Vitest.
    #   uses: codecov/codecov-action@v4
    #   with:
    #     token: ${{ secrets.CODECOV_TOKEN }}
    #     files: ./coverage/clover.xml # Adjust path to your coverage report
    #     fail_ci_if_error: true # Fail the workflow if Codecov upload fails
